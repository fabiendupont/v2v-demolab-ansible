---
- block:
    - name: Register to Red Hat Network
      command: subscription-manager register --username {{ manageiq.rhn.username }} --password {{ manageiq.rhn.password }}

    - name: Attach subscription pool
      command: subscription-manager attach --pool {{ manageiq.rhn.pool }}

    - name: Enable the relevant Red Hat repositories
      command: "subscription-manager repos --disable='*' --enable='rhel-7-server-rpms' --enable='rhel-7-server-rh-common-rpms' --enable='rhel-server-rhscl-7-rpms' --enable='rhel-7-server-optional-rpms'"

    - name: Enable EPEL repository
      yum:
        name: https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
        state: present
   when: ansible_distribution == "RedHat"

- block:
    - name: Enable additionnal repositrories
      yum:
        name: "{{ item }}"
        state: present
      with_items:
        - epel-release
        - centos-release-scl
  when: ansible_distribution == "CentOS"

